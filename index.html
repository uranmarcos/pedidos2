<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APP WEB</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.21/vue.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.1/axios.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/notificacion.css" rel="stylesheet">
    
    <!-- <link rel="stylesheet" href="estilos.css"> -->

 
</head>
<body>
    <div class="container">

        <div id="app">
            <div class="col-md-4 col-md-offset-4">
                
                <div class="panel panel-primary">
                    <div class="panel-heading d-flex justify-content-center">
                        <span class="mr-5"></span> <span class="ml-5"> Sí Pedidos</span>
                    </div>

                    <div class="panel-body">
                        <label for="user">
                            Usuario
                        </label>
                        <input type="text" class="form-control" v-model="usuario">
                        <div class="error">{{errorUsuario}}</div>
                        <br>
                        <label for="password">
                            Contraseña
                        </label>
                        <input type="password" class="form-control" v-model="password">
                        <div class="error">{{errorPassword}}</div>
                    </div>
                
                    <div class="panel-footer">
                        <button 
                            class="btn btn-primary btn-block" 
                            @click="ingresar()"
                            v-if="!loading"
                        >
                            <span class="glyphicon glyphicon-log-in">
                                
                            </span>
                            Ingresar
                        </button>

                        <button 
                            class="btn btn-primary btn-block"
                            v-if="loading" 
                        >
                            <div class="loading">
                                <div class="spinner-border" role="status">
                                    <span class="sr-only"></span>
                                </div>
                            </div>
                        </button>

                    </div>
                
                </div>
            </div>
            <div role="alert" id="mitoast" aria-live="assertive" aria-atomic="true" class="toast">
                <div class="toast-header">
                    <!-- Nombre de la Aplicación -->
                    <div class="row tituloToast" id="tituloToast">
                        <strong class="mr-auto">{{tituloToast}}</strong>
                    </div>
                </div>
                <div class="toast-content">
                    <div class="row textoToast">
                        <strong >{{textoToast}}</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <style>
        .container{
            height: 100vh;
            display: flexbox;
            align-items: center;
        }
        #app{
            height: 100vh;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;

        }
        div.panel.panel-primary{
            border: solid 1px rgb(107, 69, 142);
        }
        .panel-primary>.panel-heading{
            border: solid 1px rgb(107, 69, 142) !important;
        }
        div.panel-heading{
            background-color: rgb(107, 69, 142) !important;
            border: solid 1px rgb(107, 69, 142);
        }
        .btn-primary{
            background-color: rgb(107, 69, 142) !important;
            border: solid 1px rgb(107, 69, 142);
        }
        .btn-primary:focus{
            outline: none !important;
        }
        .error{
            font-size: 12px;
            color: red
        }
    </style>
    <script>
        var app = new Vue({
            el: "#app",
            components: {
            },
            data: {
                usuario: "",
                password: "",
                errorUsuario: null,
                errorPassword: null,
                error: false,
                loading: false,
                tituloToast: "",
                textoToast: "",
            },
            methods:{
                ingresar() {
                    this.errorUsuario = null;
                    this.errorPassword = null;
                    this.error = false;
                    if (this.usuario == null || this.usuario.trim() == '') {
                        this.errorUsuario = "Campo requerido";
                        this.error = true;
                    }
                    if (this.password == null || this.password.trim() == '') {
                        this.errorPassword = "Campo requerido";
                        this.error = true;
                    }
                    if (!this.error) {
                        this.loading= true;
                        let formdata = new FormData();
                        formdata.append("usuario", app.usuario);
                        formdata.append("password", app.password);
                        axios.post("http://localhost/proyectos/pedidos2/conexion/login.php?accion=login", formdata)
                        .then(function(response){
                            console.log(response);
                            if (response.data.error) {
                                app.mostrarToast("Error", response.data.mensaje);
                            } else {
                                if (response.data.rol == "admin") {
                                    window.location.href = 'http://localhost/proyectos/pedidos2/home.html'; 
                                } else {
                                    window.location.href = 'http://localhost/proyectos/pedidos2/secciones/pedidos.php'; 
                                }
                            }
                            app.loading = false;
                        }).catch( error => {
                            app.loading = false;
                            app.mostrarToast("Error", response.data.mensaje);
                        })
                    }
                },
                mostrarToast(titulo, texto) {
                    app.tituloToast = titulo;
                    app.textoToast = texto;
                    var toast = document.getElementById("mitoast");
                    var tituloToast = document.getElementById("tituloToast");
                    toast.classList.remove("toast");
                    toast.classList.add("mostrar");
                    setTimeout(function(){ toast.classList.toggle("mostrar"); }, 10000);
                    if (titulo == 'Éxito') {
                        toast.classList.remove("bordeError");
                        toast.classList.add("bordeExito");
                        tituloToast.className = "exito";
                    } else {
                        toast.classList.remove("bordeExito");
                        toast.classList.add("bordeError");
                        tituloToast.className = "errorModal";
                    }
                },
            }
        })
    </script>
</body>
</html>